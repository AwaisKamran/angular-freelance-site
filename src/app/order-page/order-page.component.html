<div class="order-container">
    <div class="order-detail-section">
        <div *ngIf="orderStatusSuccess" class="alert alert-success" role="alert">
            Order status has been updated.
        </div>

        <div *ngIf="orderStatusError" class="alert alert-danger" role="alert">
            Error! There was an internal server error.
        </div>

        <div class="order-detail-heading green-heading">
            <i class="fa fa-arrow-circle-o-left green-icon" aria-hidden="true" (click)="navigateToDashboard()"></i>
            Order # {{order.id}}
        </div>
        <div class="order-detail-title">{{order.service.title}}</div>
        <div class="order-detail-description">{{order.service.description}}</div><br/>
        
        <div class="price-section">
            <div [ngStyle]="{'background-image': getServiceImage(order.serviceId) }" class="float-left service-picture"></div>
            <div class="float-left">
                <!-- <div class="total-price"><span class="bold">Price</span> Â£ {{order.service.hourlyCost * order.service.minimumHours}}</div> -->
                <div class="total-price"><span class="bold">Price</span> {{ currencySymbol}} {{order.budget }}</div>
                <div class="minimum-hours"><span class="bold">Hours</span> {{ order.service.minimumHours}}</div>
                <div class="order-status">
                    <div *ngIf="order.status === '0'" class="badge-value badge-progress">Scheduled</div>
                    <div *ngIf="order.status === '1'" class="badge-value badge-revision">In Revision</div>
                    <div *ngIf="order.status === '2'" class="badge-value badge-delivered">Completed</div>
                    <div *ngIf="order.status === '3'" class="badge-value badge-accepted">Confirmed</div>
                    <!-- badge-accepted -->
                </div>
            </div>
            <div class="clear-both"></div>
        </div><br/>

        <div class="ordered-by">Ordered by <span class="green-highlight cursor-pointer" (click)="navigateToUserProfile(order.user.id)">{{ order.user.username }}</span> on {{ formatDate(order.orderCreated) }}</div>      
        <div class="ordered-by" *ngIf="(order.status === '0' || order.status === '2') && isAdmin()">
            Service Provided by 
            <span 
                class="green-highlight cursor-pointer" 
                (click)="navigateToUserProfile(order.freelancerId)">
                {{ order.freelancerName }}
            </span>
        </div>
        <hr/>

        <div class="delivery-section" *ngIf="(order.status === '0' || order.status === '1')  && !isAdmin()">
            <div class="form-group">
                <input type="file" class="form-control-file" id="fileToUpload" name="fileToUpload" (change)="onFileSelect($event)" />
            </div>
            <button class="btn btn-block btn-outline-success green-border" (click)="deliverOrder(order.id, 2)">Complete Order</button>
            <button class="btn btn-block btn-outline-danger" (click)="declineOrderByOrderId(order.id, -1)">Cancel Order</button>
            <div class="short-note">Note: If you need to upload a document, please make sure it is in a .doc or .pdf format.</div>
        </div>

        <div class="delivery-section-container" *ngIf="order.status === '2' && !isAdmin()">
            <div class="message box">
                <i class="fa fa-check-square green-large-icon" aria-hidden="true"></i> Please wait while your order is reviewed.
            </div>
        </div>

        <div class="delivery-section-container" *ngIf="(order.status === '1')  && isAdmin()">
            <div class="message box">
                <i class="fa fa-check-square green-large-icon" aria-hidden="true"></i> Please wait while your order is reviewed.
            </div>
        </div>

        <div class="delivery-section-container" *ngIf="(order.status === '0') && isAdmin()">
            <div class="message box">
                <i class="fa fa-history green-large-icon" aria-hidden="true"></i> Please wait, your order is scheduled. <br/>  
            </div>
        </div>

        <div class="delivery-section-container" *ngIf="(order.status === '-1')  && isAdmin()">
            <div class="message box">
                <i class="fa fa-rocket green-large-icon" aria-hidden="true"></i> Please wait while you receive the bids on your job.
            </div>
        </div>

        <div class="delivery-section-container" *ngIf="(order.status === '-1')  && !isAdmin()">
            <div class="row">
                <div class="col-lg-5 no-padding-right">
                    <button class="btn btn-block btn-outline-success green-border mb-1 btn-width" (click)="changeOrderStatus(order.id, 0)">Accept Request</button>
                </div>
                <div class="col-lg-5 no-padding-right">
                    <button class="btn btn-block btn-outline-danger mb-1 btn-width" (click)="declineOrderByOrderId(order.id, -1)">Decline Request</button>
                </div>
                <div class="short-note">Note - Note - Please respond to the buyer's request to accept or decline the order. Only accept once you have agreed on the price of the service. In case you fail to respond to the request, the order will be cancelled in three days.</div>
            </div>
        </div>

        <div class="admin-section" *ngIf="(order.status === '2') && isAdmin()">
            <div class="attached-file mb-1">
                <a class="download-link" [href]="downloadLink" download>
                    <i class="fa fa-paperclip green-icon" aria-hidden="true"></i> 
                    <span class="gray-text">Download the attachment</span>
                </a>
            </div>
            <div class="row">
                <div class="col-lg-5 no-padding-right">
                    <button class="btn btn-block btn-outline-success green-border mb-1 btn-width" (click)="changeOrderStatus(order.id, 3)">Confirm Order</button>
                </div>
                <div class="col-lg-5 no-padding-right">
                    <button class="btn btn-block btn-outline-danger mb-1 btn-width" (click)="changeOrderStatus(order.id, 1)">Cancel</button>
                </div>
            </div>
            <div class="short-note">Note: Confirming order cannot be reverted, please make sure the service you requested has been delivered. If service duration or quality was unsatisfactory, please confirm order if financial transaction occurred. In the event that a freelancer did not attend, please cancel order and ensure to leave a review.
            </div>
        </div>

        <div class="admin-section" *ngIf="(order.status === '3') && isAdmin()">
            <div *ngIf="order.adminRated">
                <div class="message box">
                    <i class="fa fa-thumbs-up green-large-icon" aria-hidden="true"></i> Your order has been confirmed.
                </div>
            </div>
            <div *ngIf="!order.adminRated">
                <app-rating (rated)="handleRatedEvent($event)" [display]="false" [orderId]="order.id" [orderCreatedBy]="order.user.id" [freelancerId]="order.freelancerId"></app-rating>
            </div>
        </div>

        <div class="admin-section" *ngIf="(order.status === '3') && !isAdmin()">
            <div *ngIf="order.freelancerRated">
                <div class="message box">
                    <i class="fa fa-thumbs-up green-large-icon" aria-hidden="true"></i> Your order has been completed.
                </div>
            </div>
            <div *ngIf="!order.freelancerRated">
                <app-rating (rated)="handleRatedEvent($event)" [display]="false" [orderId]="order.id" [orderCreatedBy]="order.user.id" [freelancerId]="order.freelancerId"></app-rating>
            </div>
        </div>

        <hr/>
        <app-comment-list [orderId]="id"></app-comment-list>
    </div><br/><br/>
</div>
